<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý Khóa học</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>

<div class="container-fluid mt-4">
    <!-- Nav tabs -->
    <ul class="nav nav-tabs" id="myTab" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#courses">Khóa học</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#teachers">Giáo viên</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#students">Sinh viên</button>
        </li>
    </ul>

    <!-- Tab content -->
    <div class="tab-content mt-3">
        <!-- Courses Tab -->
        <div class="tab-pane fade show active" id="courses">
            <div class="d-flex justify-content-between mb-3">
                <h3>Danh sách khóa học</h3>
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addCourseModal">
                    <i class="fas fa-plus"></i> Thêm khóa học
                </button>
            </div>
            <div class="table-responsive">
                <table class="table table-striped table-bordered">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Tên khóa học</th>
                            <th>Giáo viên</th>
                            <th>Thời gian</th>
                            <th>Số lượng học viên</th>
                            <th>Thao tác</th>
                        </tr>
                    </thead>
                    <tbody id="coursesList">
                        <!-- Data will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Teachers Tab -->
        <div class="tab-pane fade" id="teachers">
            <div class="d-flex justify-content-between mb-3">
                <h3>Danh sách giáo viên</h3>
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addTeacherModal">
                    <i class="fas fa-plus"></i> Thêm giáo viên
                </button>
            </div>
            <div class="table-responsive">
                <table class="table table-striped table-bordered">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Họ tên</th>
                            <th>Email</th>
                            <th>Số điện thoại</th>
                            <th>Chuyên môn</th>
                            <th>Thao tác</th>
                        </tr>
                    </thead>
                    <tbody id="teachersList">
                        <!-- Data will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Students Tab -->
        <div class="tab-pane fade" id="students">
            <div class="d-flex justify-content-between mb-3">
                <h3>Danh sách sinh viên</h3>
            </div>
            <div class="table-responsive">
                <table class="table table-striped table-bordered">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Họ tên</th>
                            <th>Email</th>
                            <th>Số điện thoại</th>
                            <th>Khóa học đăng ký</th>
                            <th>Thao tác</th>
                        </tr>
                    </thead>
                    <tbody id="studentsList">
                        <!-- Data will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Add Course Modal -->
<div class="modal fade" id="addCourseModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Thêm khóa học mới</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="addCourseForm">
                    <div class="mb-3">
                        <label class="form-label">Tên khóa học</label>
                        <input type="text" class="form-control" name="courseName" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Giáo viên phụ trách</label>
                        <select class="form-select" name="teacherId" required>
                            <!-- Teachers will be loaded here -->
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Thời gian học</label>
                        <input type="text" class="form-control" name="duration" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Số lượng học viên tối đa</label>
                        <input type="number" class="form-control" name="maxStudents" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                <button type="button" class="btn btn-primary" id="saveCourse">Lưu</button>
            </div>
        </div>
    </div>
</div>

<!-- Add Teacher Modal -->
<div class="modal fade" id="addTeacherModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Thêm giáo viên mới</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="create-teacher-form">
                    <div class="mb-3">
                        <label for="username" class="form-label">Username</label>
                        <input type="text" class="form-control" id="username" name="username" required>
                    </div>
        
                    <div class="mb-3">
                        <label for="email" class="form-label">Email</label>
                        <input type="email" class="form-control" id="email" name="email" required>
                    </div>
        
                    <div class="mb-3">
                        <label for="password" class="form-label">Password</label>
                        <input type="password" class="form-control" id="password" name="password" required>
                    </div>
        
                    <div class="mb-3">
                        <label for="password2" class="form-label">Confirm Password</label>
                        <input type="password" class="form-control" id="password2" name="password2" required>
                        <span id="password-error" class="error"></span>  <!-- Hiển thị lỗi nếu mật khẩu không khớp -->
                    </div>
        
                    <div class="mb-3">
                        <label for="fullname" class="form-label">Full Name</label>
                        <input type="text" class="form-control" id="fullname" name="fullname" required>
                    </div>
        
                    <div class="mb-3">
                        <label for="phone" class="form-label">Phone</label>
                        <input type="text" class="form-control" id="phone" name="phone">
                    </div>
        
                    <div class="mb-3">
                        <label for="address" class="form-label">Address</label>
                        <input type="text" class="form-control" id="address" name="address">
                    </div>
        
                    <div class="mb-3">
                        <label for="date_of_birth" class="form-label">Date of Birth</label>
                        <input type="date" class="form-control" id="date_of_birth" name="date_of_birth">
                    </div>
        
                    <div class="mb-3">
                        <label for="education_level" class="form-label">Education Level</label>
                        <select class="form-select" id="education_level" name="education_level" required>
                            <option value="bachelor">Bachelor</option>
                            <option value="master">Master</option>
                            <option value="phd">PhD</option>
                        </select>
                    </div>
        
                    <button type="submit" class="btn btn-primary">Create Teacher</button>
                </form>
            </div>
            
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
$(document).ready(function() {
    // Load initial data
    loadCourses();
    loadTeachers();
    loadStudents();


    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
    $('#create-teacher-form').on('submit', function(e) {
        e.preventDefault();
        
        const password = $('input[name="password"]').val();
        const password2 = $('input[name="password2"]').val();
        
        const formData = {
            username: $('input[name="username"]').val(),
            email: $('input[name="email"]').val(),
            password: password,
            password2: password2,
            fullname: $('input[name="fullname"]').val(),
            phone: $('input[name="phone"]').val(),
            address: $('input[name="address"]').val(),
            date_of_birth: $('input[name="date_of_birth"]').val(),
            education_level: $('select[name="education_level"]').val(),
        };

        if (formData.password !== formData.password2) {
            alert('Mật khẩu xác nhận không khớp!');
            return;
        }

        $.ajax({
            url: 'http://127.0.0.1:8000/api/create/teacher/',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(formData),
            headers: {
                'X-CSRFToken': getCookie('csrftoken')
            },
            success: function(response) {
                alert('Đăng ký thành công!');
                $('#create-teacher-form').modal('hide');
                $('#studentRegisterForm')[0].reset();
               
            },
            error: function(xhr) {
                if (xhr.responseJSON) {
                    const errors = xhr.responseJSON;
                    if (errors.username) {
                        alert('Lỗi tên đăng nhập: ' + errors.username.join(', '));
                    } else if (errors.email) {
                        alert('Lỗi email: ' + errors.email.join(', '));
                    } else if (errors.password) {
                        alert('Lỗi mật khẩu: ' + errors.password.join(', '));
                    } else {
                        alert('Đăng ký thất bại. Vui lòng kiểm tra lại thông tin.');
                    }
                } else {
                    alert('Có lỗi xảy ra. Vui lòng thử lại sau.');
                }
            }
        });
    });

  
});
</script>

</body>
</html>