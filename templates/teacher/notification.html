<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý thông báo - Giáo viên</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.5/font/bootstrap-icons.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1>Quản lý thông báo (Giáo viên)</h1>

        <!-- Form gửi thông báo mới -->
        <div class="mt-4">
            <h3>Gửi thông báo mới</h3>
            <form id="newNotificationForm">
                <div class="mb-3">
                    <label for="newNotificationTitle" class="form-label">Tiêu đề</label>
                    <input type="text" class="form-control" id="newNotificationTitle" placeholder="Nhập tiêu đề thông báo" required>
                </div>
                <div class="mb-3">
                    <label for="newNotificationContent" class="form-label">Nội dung</label>
                    <textarea class="form-control" id="newNotificationContent" rows="4" placeholder="Nhập nội dung thông báo" required></textarea>
                </div>
                <button type="submit" class="btn btn-success">
                    <i class="bi bi-send"></i> Gửi
                </button>
            </form>
        </div>

        <!-- Danh sách thông báo đã gửi -->
        <div class="mt-5">
            <h3>Danh sách thông báo</h3>
            <ul id="notificationList" class="list-group">
                <!-- Các thông báo sẽ được thêm bằng JavaScript -->
            </ul>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script >
document.addEventListener("DOMContentLoaded", () => {
    const notificationList = document.getElementById("notificationList");
    const notificationForm = document.getElementById("newNotificationForm");

    // Kết nối WebSocket
    const courseId = 5; // ID của khóa học
    const socket = new WebSocket(`ws://127.0.0.1:8000/ws/notifications/${courseId}/`);

    socket.onopen = () => {
        console.log("WebSocket kết nối thành công!");
    };

    socket.onmessage = (event) => {
        const data = JSON.parse(event.data);
        const { title, content, sender, time } = data;

        // Thêm thông báo mới vào danh sách
        const notificationItem = document.createElement("li");
        notificationItem.classList.add("list-group-item");
        notificationItem.innerHTML = `
            <strong>${title}</strong><br>
            <small>Người gửi: ${sender} | Thời gian: ${time}</small><br>
            ${content}
        `;
        notificationList.appendChild(notificationItem);
    };

    notificationForm.addEventListener("submit", (e) => {
        e.preventDefault();

        const title = document.getElementById("newNotificationTitle").value;
        const content = document.getElementById("newNotificationContent").value;
        const sender = 5; // Bạn có thể thay đổi thông tin này nếu cần
        const time = new Date().toISOString().slice(0, 19).replace("T", " ");

        // Gửi thông báo qua WebSocket
        const message = { title, content, sender, time };
        socket.send(JSON.stringify(message));

        // Xóa form sau khi gửi
        notificationForm.reset();
    });

    socket.onclose = () => {
        console.log("WebSocket đã đóng kết nối!");
    };

    socket.onerror = (error) => {
        console.error("Lỗi WebSocket:", error);
    };
});

    </script>
</body>
</html>
